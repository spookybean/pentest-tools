from scapy.all import ARP, Ether, srp
import argparse

parser = argparse.ArgumentParser(description='ARP scanner of the network')
parser.add_argument('-i', '--ip', type=str, metavar='', help='ip/cidr', required=True)
args = parser.parse_args()

def scanner(ip):
    arp_request = ARP(pdst=ip)
    broadcast = Ether(dst='ff:ff:ff:ff:ff:ff')
    arp_packet = broadcast/arp_request
    answer = srp(arp_packet, timeout=3, verbose=False)[0]
    clients = []

    for sent, received in answer:
        clients.append({'ip': received.psrc, 'mac': received.hwsrc})

    return clients       

if __name__ == '__main__':
    scan_result = scanner(args.ip)
    try:
        print('Available devices in the network: ')
        print('{:16}     {}'.format('IP', 'MAC'))
        for client in scan_result:
            print('{:16}    {}'.format(client['ip'], client['mac']))
    except TypeError:
        print('No devices found')
